function refreshBounds(a){if("Battle Board"==a){let t=document.oWindow.innerWidth/2,e=document.oWindow.innerHeight/2,i=document.oRuntime.viewportWidth/2,o=document.oRuntime.viewportHeight/2,l=t/i,r=e/o;try{let n=document.oWindow.innerWidth/2,B=480*l;r<l&&(B=480*r);let $=(n-=B/2)+B;document.dMinX=n,document.dMaxX=$,document.dMinY=document.oWindow.innerHeight/2-B/2,document.dMaxY=document.oWindow.innerHeight/2+B/2,document.dWidth=document.dMaxX-document.dMinX,document.dHeight=document.dMaxY-document.dMinY,document.dBoardWidth=B}catch(d){alert(d)}}else if("Dungeon"==a){let g=document.oWindow.innerWidth/2,_=document.oWindow.innerHeight/2,s=document.oRuntime.viewportWidth/2,h=document.oRuntime.viewportHeight/2,k=g/s,v=_/h;try{let M=document.oWindow.innerWidth/2,c=420*k,u=360*k;v<k&&(c=420*v,u=420*v);let f=(M-=c/2)+c;document.dMinX=M,document.dMaxX=f,document.dMinY=document.oWindow.innerHeight/2-u/2,document.dMaxY=document.oWindow.innerHeight/2+u/2,document.dWidth=document.dMaxX-document.dMinX,document.dHeight=document.dMaxY-document.dMinY,document.dBoardWidth=c,document.dBoardHeight=u}catch(D){alert(D)}}}async function OnBeforeProjectStart(a){a.addEventListener("tick",()=>Tick(a)),document.oRuntime=a,document.oCanvas=document.getElementsByTagName("canvas")[0],document.oWindow=window,refreshBounds(document.oRuntime.layout.name),document.oCanvas.addEventListener("click",function(a){fEvent_Click(a,document.oCanvas)}),document.oCanvas.addEventListener("touchend",function(a){fEvent_TouchEnd(a,document.oCanvas)}),document.oCanvas.addEventListener("mousemove",function(a){fEvent_MouseMove(a,document.oCanvas)}),document.oCanvas.addEventListener("touchmove",function(a){fEvent_TouchMove(a,document.oCanvas)}),document.oCanvas.addEventListener("touchstart",function(a){fEvent_TouchStart(a,document.oCanvas)}),document.btnListeners=!1,document.fRenderLayout=function(a){let t=!1;if(a>=0?t=!0:a=0,"Battle Board"===document.oRuntime.layout.name){refreshBounds(document.oRuntime.layout.name);try{for(let e=a;e<document.aBattleBoard.length;e++){let i=Math.floor(e/8),o=e%8,l=157+(8-i)*60,r=-30+(8-o)*60,n=null;switch(document.aBattleBoard[e]){case iLightPawn:n=document.oRuntime.objects.LightPawn;break;case iLightBishop:n=document.oRuntime.objects.LightBishop;break;case iLightKnight:n=document.oRuntime.objects.LightKnight;break;case iLightFreshRook:case iLightMovedRook:n=document.oRuntime.objects.LightRook;break;case iLightQueen:n=document.oRuntime.objects.LightQueen;break;case iLightFreshKing:case iLightMovedKing:n=document.oRuntime.objects.LightKing;break;case iDarkPawn:n=document.oRuntime.objects.DarkPawn;break;case iDarkBishop:n=document.oRuntime.objects.DarkBishop;break;case iDarkKnight:n=document.oRuntime.objects.DarkKnight;break;case iDarkFreshRook:case iDarkMovedRook:n=document.oRuntime.objects.DarkRook;break;case iDarkQueen:n=document.oRuntime.objects.DarkQueen;break;case iDarkFreshKing:case iDarkMovedKing:n=document.oRuntime.objects.DarkKing}n&&(document.aBattleBoardSprites[parseInt(o)+parseInt(8*i)]=n.createInstance(0,l,r)),t&&(e=document.aBattleBoard.length)}for(let B=1;B<document.oRuntime.objects.LightPawn.getAllInstances().length;B++)document.oRuntime.objects.LightPawn.getAllInstances()[B].isVisible=!0;for(let $=1;$<document.oRuntime.objects.LightBishop.getAllInstances().length;$++)document.oRuntime.objects.LightBishop.getAllInstances()[$].isVisible=!0;for(let d=1;d<document.oRuntime.objects.LightKnight.getAllInstances().length;d++)document.oRuntime.objects.LightKnight.getAllInstances()[d].isVisible=!0;for(let g=1;g<document.oRuntime.objects.LightRook.getAllInstances().length;g++)document.oRuntime.objects.LightRook.getAllInstances()[g].isVisible=!0;for(let _=1;_<document.oRuntime.objects.LightQueen.getAllInstances().length;_++)document.oRuntime.objects.LightQueen.getAllInstances()[_].isVisible=!0;for(let s=1;s<document.oRuntime.objects.LightKing.getAllInstances().length;s++)document.oRuntime.objects.LightKing.getAllInstances()[s].isVisible=!0;for(let h=1;h<document.oRuntime.objects.DarkPawn.getAllInstances().length;h++)document.oRuntime.objects.DarkPawn.getAllInstances()[h].isVisible=!0;for(let k=1;k<document.oRuntime.objects.DarkBishop.getAllInstances().length;k++)document.oRuntime.objects.DarkBishop.getAllInstances()[k].isVisible=!0;for(let v=1;v<document.oRuntime.objects.DarkKnight.getAllInstances().length;v++)document.oRuntime.objects.DarkKnight.getAllInstances()[v].isVisible=!0;for(let M=1;M<document.oRuntime.objects.DarkRook.getAllInstances().length;M++)document.oRuntime.objects.DarkRook.getAllInstances()[M].isVisible=!0;for(let c=1;c<document.oRuntime.objects.DarkQueen.getAllInstances().length;c++)document.oRuntime.objects.DarkQueen.getAllInstances()[c].isVisible=!0;for(let u=1;u<document.oRuntime.objects.DarkKing.getAllInstances().length;u++)document.oRuntime.objects.DarkKing.getAllInstances()[u].isVisible=!0;if(!t){let f=document.oRuntime.objects.DungeonEntrance.getAllInstances();for(let D=1;D<f.length;D++){let L=f[D];L.isVisible=!1,L.gone=!0,L.destroy()}for(let K=0;K<document.aEntranceOverlay.length;K++){let w=Math.floor(K/8),b=K%8,P=157+(8-w)*60,m=-30+(8-b)*60;if(document.aEntranceOverlay[K]==iDungeonEntrance){document.oRuntime.objects.DungeonEntrance.createInstance(0,P,m);break}}for(let R=1;R<document.oRuntime.objects.DungeonEntrance.getAllInstances().length;R++)document.oRuntime.objects.DungeonEntrance.getAllInstances()[R].isVisible=!0}}catch(V){alert(V)}}},document.fRenderValidMoves=function(){if("Battle Board"===document.oRuntime.layout.name){refreshBounds(document.oRuntime.layout.name);try{let a=document.oRuntime.objects.ValidDestination.getAllInstances();for(let t=1;t<a.length;t++){let e=a[t];e.isVisible=!1,e.gone=!0,e.destroy()}for(let i=0;i<document.aMoveOverlay.length;i++){let o=Math.floor(i/8),l=i%8,r=157+(8-o)*60,n=-30+(8-l)*60;fIsValidMove(document.aMoveOverlay[i])&&document.oRuntime.objects.ValidDestination.createInstance(0,r,n)}for(let B=1;B<document.oRuntime.objects.ValidDestination.getAllInstances().length;B++){let $=document.oRuntime.objects.ValidDestination.getAllInstances()[B];$.gone||($.isVisible=!0)}}catch(d){alert(d)}}},document.fClick=function(a){let t=a.getAttribute("op");switch(t){case"NEW_GAME":fNewGame();break;case"MAIN_MENU":fMainMenu();break;case"GO_TO_DUNGEON":fDungeon();break;case"GO_TO_BATTLE":case"RESUME":fBattle()}}}runOnStartup(async a=>{a.addEventListener("beforeprojectstart",()=>OnBeforeProjectStart(a))});const iLightPawn=1,iLightBishop=2,iLightKnight=3,iLightFreshRook=4,iLightMovedRook=5,iLightQueen=6,iLightFreshKing=7,iLightMovedKing=8,iDarkPawn=10,iDarkBishop=11,iDarkKnight=12,iDarkFreshRook=13,iDarkMovedRook=14,iDarkQueen=15,iDarkFreshKing=16,iDarkMovedKing=17,iDungeonEntrance=100,iValidMoveSimple=999,iValidMoveKingsafe=999.1,iValidMoveQuietThreat=999.2,iValidMoveCastle=999.3,iValidMoveStart=1e3,iValidMoveEnd=1999;function fIsValidMove(a){return a>=iValidMoveSimple&&a<=1999&&999.2!=a}function fClearValidMoves(a,t){a||(a="aMoveOverlay"),t||(document[a]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,])}function fInitializeGame(){document.aBattleBoardHistory=[],document.aBattleBoardSprites=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],document.aBattleBoard=[iDarkFreshRook,iDarkKnight,iDarkBishop,iDarkFreshKing,iDarkQueen,iDarkBishop,iDarkKnight,iDarkFreshRook,iDarkPawn,iDarkPawn,iDarkPawn,iDarkPawn,iDarkPawn,iDarkPawn,iDarkPawn,iDarkPawn,0,0,0,0,0,0,0,0,0,0,0,0,iLightQueen,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,iLightPawn,iLightPawn,iLightPawn,iLightPawn,iLightPawn,iLightPawn,iLightPawn,iLightPawn,iLightFreshRook,iLightKnight,iLightBishop,iLightFreshKing,iLightQueen,iLightBishop,iLightKnight,iLightFreshRook],document.aEntranceOverlay=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,];let a=0;for(let t=0;t<document.aEntranceOverlay.length;t++)-1==document.aEntranceOverlay[t]&&(a+=1);let e=Math.floor(Math.random()*a);a=0;for(let i=0;i<document.aEntranceOverlay.length;i++)if(-1==document.aEntranceOverlay[i]){if(a==e){document.aEntranceOverlay[i]=iDungeonEntrance;break}a+=1}fClearValidMoves(),fClearValidMoves("aControlledOverlay")}document.aBattleBoardHistory=null,document.aBattleBoard=null,document.aEntranceOverlay=null,document.aMoveOverlay=null,document.aControlledOverlay=null,document.aBattleBoardSprites=null;var callstack=0;function fMarkValidMoves(a,t,e,i){callstack+=1,e||(e="aMoveOverlay"),fClearValidMoves(e,i);let o=1,l=parseInt(a)+8*parseInt(t),r=null,n=null,B=null,$=null,d=null,g=null,_=null,s=null,h=iValidMoveSimple;switch(document.aBattleBoard[l]){case iLightPawn:if(h=iValidMoveSimple,r=[parseInt(a),parseInt(t)-1],n=[parseInt(a),parseInt(t)-2],B=[parseInt(a)-1,parseInt(t)-1],$=[parseInt(a)+1,parseInt(t)-1],(l=r[0]+8*r[1])<document[e].length&&l>=0&&0==document.aBattleBoard[l]&&(0==document[e][l]&&(document[e][l]=999.1),6==t&&(l=n[0]+8*n[1])<document[e].length&&l>=0&&0==document.aBattleBoard[l]&&0==document[e][l]&&(document[e][l]=999.1)),(l=B[0]+8*B[1])<document[e].length&&l>=0&&parseInt(a)-1>=0&&parseInt(t)-1>=0){if(document[e][l]=999.2,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing)document[e][l]=h;else if(0==document.aBattleBoard[l]&&3==t&&document.aBattleBoardHistory.length>=1){let k=document.aBattleBoardHistory[0],v=[parseInt(a)-1,parseInt(t)-2],M=[parseInt(a)-1,parseInt(t)],c=v[0]+8*v[1],u=M[0]+8*M[1];k[c]==iDarkPawn&&0==k[u]&&0==document.aBattleBoard[c]&&document.aBattleBoard[u]==iDarkPawn&&0==document[e][l]&&(document[e][l]=1e3+u)}}if((l=$[0]+8*$[1])<document[e].length&&l>=0&&parseInt(a)+1<=7&&parseInt(t)-1>=0){if(document[e][l]=999.2,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing)document[e][l]=h;else if(0==document.aBattleBoard[l]&&3==t&&document.aBattleBoardHistory.length>=1){let f=document.aBattleBoardHistory[0],D=[parseInt(a)+1,parseInt(t)-2],L=[parseInt(a)+1,parseInt(t)],K=D[0]+8*D[1],w=L[0]+8*L[1];f[K]==iDarkPawn&&0==f[w]&&0==document.aBattleBoard[K]&&document.aBattleBoard[w]==iDarkPawn&&0==document[e][l]&&(document[e][l]=1e3+w)}}break;case iLightBishop:for(o=1,h=iValidMoveSimple,r=[parseInt(a)-o,parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)-o,parseInt(t)-o++])if(document[e][l]=h,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing){if(document.aBattleBoard[l]>=iDarkFreshKing&&document.aBattleBoard[l]<=iDarkMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)+o,parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)+o,parseInt(t)-o++])if(document[e][l]=h,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing){if(document.aBattleBoard[l]>=iDarkFreshKing&&document.aBattleBoard[l]<=iDarkMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)-o,parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)-o,parseInt(t)+o++])if(document[e][l]=h,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing){if(document.aBattleBoard[l]>=iDarkFreshKing&&document.aBattleBoard[l]<=iDarkMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)+o,parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)+o,parseInt(t)+o++])if(document[e][l]=h,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing){if(document.aBattleBoard[l]>=iDarkFreshKing&&document.aBattleBoard[l]<=iDarkMovedKing)h=999.2;else break}break;case iLightKnight:h=iValidMoveSimple,r=[parseInt(a)+2,parseInt(t)+1],n=[parseInt(a)+2,parseInt(t)-1],B=[parseInt(a)+1,parseInt(t)+2],$=[parseInt(a)-1,parseInt(t)+2],d=[parseInt(a)-2,parseInt(t)+1],g=[parseInt(a)-2,parseInt(t)-1],_=[parseInt(a)+1,parseInt(t)-2],s=[parseInt(a)-1,parseInt(t)-2],l=r[0]+8*r[1],r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing||(document[e][l]=h)),l=n[0]+8*n[1],n[0]>=0&&n[0]<=7&&n[1]>=0&&n[1]<=7&&(document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing||(document[e][l]=h)),l=B[0]+8*B[1],B[0]>=0&&B[0]<=7&&B[1]>=0&&B[1]<=7&&(document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing||(document[e][l]=h)),l=$[0]+8*$[1],$[0]>=0&&$[0]<=7&&$[1]>=0&&$[1]<=7&&(document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing||(document[e][l]=h)),l=d[0]+8*d[1],d[0]>=0&&d[0]<=7&&d[1]>=0&&d[1]<=7&&(document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing||(document[e][l]=h)),l=g[0]+8*g[1],g[0]>=0&&g[0]<=7&&g[1]>=0&&g[1]<=7&&(document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing||(document[e][l]=h)),l=_[0]+8*_[1],_[0]>=0&&_[0]<=7&&_[1]>=0&&_[1]<=7&&(document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing||(document[e][l]=h)),l=s[0]+8*s[1],s[0]>=0&&s[0]<=7&&s[1]>=0&&s[1]<=7&&(document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing||(document[e][l]=h));break;case iLightQueen:for(o=1,h=iValidMoveSimple,r=[parseInt(a)-o,parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)-o,parseInt(t)-o++])if(document[e][l]=h,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing){if(document.aBattleBoard[l]>=iDarkFreshKing&&document.aBattleBoard[l]<=iDarkMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)+o,parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)+o,parseInt(t)-o++])if(document[e][l]=h,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing){if(document.aBattleBoard[l]>=iDarkFreshKing&&document.aBattleBoard[l]<=iDarkMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)-o,parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)-o,parseInt(t)+o++])if(document[e][l]=h,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing){if(document.aBattleBoard[l]>=iDarkFreshKing&&document.aBattleBoard[l]<=iDarkMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)+o,parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)+o,parseInt(t)+o++])if(document[e][l]=h,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing){if(document.aBattleBoard[l]>=iDarkFreshKing&&document.aBattleBoard[l]<=iDarkMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)-o++,parseInt(t)];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)-o++,parseInt(t)])if(document[e][l]=h,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing){if(document.aBattleBoard[l]>=iDarkFreshKing&&document.aBattleBoard[l]<=iDarkMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a),parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a),parseInt(t)-o++])if(document[e][l]=h,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing){if(document.aBattleBoard[l]>=iDarkFreshKing&&document.aBattleBoard[l]<=iDarkMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)+o++,parseInt(t)];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)+o++,parseInt(t)])if(document[e][l]=h,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing){if(document.aBattleBoard[l]>=iDarkFreshKing&&document.aBattleBoard[l]<=iDarkMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a),parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a),parseInt(t)+o++])if(document[e][l]=h,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing){if(document.aBattleBoard[l]>=iDarkFreshKing&&document.aBattleBoard[l]<=iDarkMovedKing)h=999.2;else break}break;case iLightFreshRook:case iLightMovedRook:for(o=1,h=iValidMoveSimple,r=[parseInt(a)-o++,parseInt(t)];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)-o++,parseInt(t)])if(document[e][l]=h,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing){if(document.aBattleBoard[l]>=iDarkFreshKing&&document.aBattleBoard[l]<=iDarkMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a),parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a),parseInt(t)-o++])if(document[e][l]=h,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing){if(document.aBattleBoard[l]>=iDarkFreshKing&&document.aBattleBoard[l]<=iDarkMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)+o++,parseInt(t)];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)+o++,parseInt(t)])if(document[e][l]=h,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing){if(document.aBattleBoard[l]>=iDarkFreshKing&&document.aBattleBoard[l]<=iDarkMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a),parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a),parseInt(t)+o++])if(document[e][l]=h,document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing){if(document.aBattleBoard[l]>=iDarkFreshKing&&document.aBattleBoard[l]<=iDarkMovedKing)h=999.2;else break}break;case iLightFreshKing:case iLightMovedKing:for(h=iValidMoveSimple,r=[parseInt(a)-o,parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)-o,parseInt(t)-o++]){document[e][l]=h;break}for(o=1,r=[parseInt(a)+o,parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)+o,parseInt(t)-o++]){document[e][l]=h;break}for(o=1,r=[parseInt(a)-o,parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)-o,parseInt(t)+o++]){document[e][l]=h;break}for(o=1,r=[parseInt(a)+o,parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)+o,parseInt(t)+o++]){document[e][l]=h;break}for(o=1,r=[parseInt(a)-o++,parseInt(t)];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)-o++,parseInt(t)]){document[e][l]=h;break}for(o=1,r=[parseInt(a),parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a),parseInt(t)-o++]){document[e][l]=h;break}for(o=1,r=[parseInt(a)+o++,parseInt(t)];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a)+o++,parseInt(t)]){document[e][l]=h;break}for(o=1,r=[parseInt(a),parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iLightPawn)||!(document.aBattleBoard[l]<=iLightMovedKing));r=[parseInt(a),parseInt(t)+o++]){document[e][l]=h;break}fClearValidMoves("aControlledOverlay");for(let b=0;b<8;b++)for(let P=0;P<8;P++)switch(l=b+8*P,document.aBattleBoard[l]){case iDarkPawn:case iDarkBishop:case iDarkKnight:case iDarkFreshRook:case iDarkMovedRook:case iDarkQueen:fMarkValidMoves(b,P,"aControlledOverlay",!0)}for(let m=0;m<document.aControlledOverlay.length;m++)0!=document.aControlledOverlay[m]&&999.1!=document.aControlledOverlay[m]&&(document.aMoveOverlay[m]=0);document.aBattleBoard[parseInt(a)+8*parseInt(t)]==iLightFreshKing&&(0==document.aBattleBoard[parseInt(a)+8*parseInt(t)-1]&&0==document.aControlledOverlay[parseInt(a)+8*parseInt(t)-1]&&0==document.aBattleBoard[parseInt(a)+8*parseInt(t)-2]&&0==document.aControlledOverlay[parseInt(a)+8*parseInt(t)-2]&&document.aBattleBoard[parseInt(a)+8*parseInt(t)-3]==iLightFreshRook&&(document[e][parseInt(a)+8*parseInt(t)-2]=999.3),0==document.aBattleBoard[parseInt(a)+8*parseInt(t)+1]&&0==document.aControlledOverlay[parseInt(a)+8*parseInt(t)+1]&&0==document.aBattleBoard[parseInt(a)+8*parseInt(t)+2]&&0==document.aControlledOverlay[parseInt(a)+8*parseInt(t)+2]&&0==document.aBattleBoard[parseInt(a)+8*parseInt(t)+3]&&document.aBattleBoard[parseInt(a)+8*parseInt(t)+4]==iLightFreshRook&&(document[e][parseInt(a)+8*parseInt(t)+2]=999.3));break;case iDarkPawn:if(h=iValidMoveSimple,r=[parseInt(a),parseInt(t)+1],n=[parseInt(a),parseInt(t)+2],B=[parseInt(a)-1,parseInt(t)+1],$=[parseInt(a)+1,parseInt(t)+1],(l=r[0]+8*r[1])<document[e].length&&l>=0&&0==document.aBattleBoard[l]&&(0==document[e][l]&&(document[e][l]=999.1),1==t&&(l=n[0]+8*n[1])<document[e].length&&l>=0&&0==document.aBattleBoard[l]&&0==document[e][l]&&(document[e][l]=999.1)),(l=B[0]+8*B[1])<document[e].length&&l>=0&&parseInt(a)-1>=0&&parseInt(t)+1<=7){if(document[e][l]=999.2,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing)document[e][l]=h;else if(0==document.aBattleBoard[l]&&4==t&&document.aBattleBoardHistory.length>=1){let R=document.aBattleBoardHistory[0],V=[parseInt(a)-1,parseInt(t)+2],y=[parseInt(a)-1,parseInt(t)],p=V[0]+8*V[1],F=y[0]+8*y[1];R[p]==iLightPawn&&0==R[F]&&0==document.aBattleBoard[p]&&document.aBattleBoard[F]==iLightPawn&&0==document[e][l]&&(document[e][l]=1e3+F)}}if((l=$[0]+8*$[1])<document[e].length&&l>=0&&parseInt(a)+1<=7&&parseInt(t)+1<=7){if(document[e][l]=999.2,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing)document[e][l]=h;else if(0==document.aBattleBoard[l]&&4==t&&document.aBattleBoardHistory.length>=1){let S=document.aBattleBoardHistory[0],j=[parseInt(a)+1,parseInt(t)+2],O=[parseInt(a)+1,parseInt(t)],I=j[0]+8*j[1],E=O[0]+8*O[1];S[I]==iLightPawn&&0==S[E]&&0==document.aBattleBoard[I]&&document.aBattleBoard[E]==iLightPawn&&0==document[e][l]&&(document[e][l]=1e3+E)}}break;case iDarkBishop:for(o=1,h=iValidMoveSimple,r=[parseInt(a)-o,parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)-o,parseInt(t)-o++])if(document[e][l]=h,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing){if(document.aBattleBoard[l]>=iLightFreshKing&&document.aBattleBoard[l]<=iLightMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)+o,parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)+o,parseInt(t)-o++])if(document[e][l]=h,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing){if(document.aBattleBoard[l]>=iLightFreshKing&&document.aBattleBoard[l]<=iLightMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)-o,parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)-o,parseInt(t)+o++])if(document[e][l]=h,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing){if(document.aBattleBoard[l]>=iLightFreshKing&&document.aBattleBoard[l]<=iLightMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)+o,parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)+o,parseInt(t)+o++])if(document[e][l]=h,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing){if(document.aBattleBoard[l]>=iLightFreshKing&&document.aBattleBoard[l]<=iLightMovedKing)h=999.2;else break}break;case iDarkKnight:h=iValidMoveSimple,r=[parseInt(a)+2,parseInt(t)+1],n=[parseInt(a)+2,parseInt(t)-1],B=[parseInt(a)+1,parseInt(t)+2],$=[parseInt(a)-1,parseInt(t)+2],d=[parseInt(a)-2,parseInt(t)+1],g=[parseInt(a)-2,parseInt(t)-1],_=[parseInt(a)+1,parseInt(t)-2],s=[parseInt(a)-1,parseInt(t)-2],l=r[0]+8*r[1],r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing||(document[e][l]=h)),l=n[0]+8*n[1],n[0]>=0&&n[0]<=7&&n[1]>=0&&n[1]<=7&&(document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing||(document[e][l]=h)),l=B[0]+8*B[1],B[0]>=0&&B[0]<=7&&B[1]>=0&&B[1]<=7&&(document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing||(document[e][l]=h)),l=$[0]+8*$[1],$[0]>=0&&$[0]<=7&&$[1]>=0&&$[1]<=7&&(document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing||(document[e][l]=h)),l=d[0]+8*d[1],d[0]>=0&&d[0]<=7&&d[1]>=0&&d[1]<=7&&(document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing||(document[e][l]=h)),l=g[0]+8*g[1],g[0]>=0&&g[0]<=7&&g[1]>=0&&g[1]<=7&&(document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing||(document[e][l]=h)),l=_[0]+8*_[1],_[0]>=0&&_[0]<=7&&_[1]>=0&&_[1]<=7&&(document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing||(document[e][l]=h)),l=s[0]+8*s[1],s[0]>=0&&s[0]<=7&&s[1]>=0&&s[1]<=7&&(document.aBattleBoard[l]>=iDarkPawn&&document.aBattleBoard[l]<=iDarkMovedKing||(document[e][l]=h));break;case iDarkQueen:for(o=1,h=iValidMoveSimple,r=[parseInt(a)-o,parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)-o,parseInt(t)-o++])if(document[e][l]=h,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing){if(document.aBattleBoard[l]>=iLightFreshKing&&document.aBattleBoard[l]<=iLightMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)+o,parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)+o,parseInt(t)-o++])if(document[e][l]=h,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing){if(document.aBattleBoard[l]>=iLightFreshKing&&document.aBattleBoard[l]<=iLightMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)-o,parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)-o,parseInt(t)+o++])if(document[e][l]=h,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing){if(document.aBattleBoard[l]>=iLightFreshKing&&document.aBattleBoard[l]<=iLightMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)+o,parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)+o,parseInt(t)+o++])if(document[e][l]=h,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing){if(document.aBattleBoard[l]>=iLightFreshKing&&document.aBattleBoard[l]<=iLightMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)-o++,parseInt(t)];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)-o++,parseInt(t)])if(document[e][l]=h,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing){if(document.aBattleBoard[l]>=iLightFreshKing&&document.aBattleBoard[l]<=iLightMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a),parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a),parseInt(t)-o++])if(document[e][l]=h,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing){if(document.aBattleBoard[l]>=iLightFreshKing&&document.aBattleBoard[l]<=iLightMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)+o++,parseInt(t)];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)+o++,parseInt(t)])if(document[e][l]=h,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing){if(document.aBattleBoard[l]>=iLightFreshKing&&document.aBattleBoard[l]<=iLightMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a),parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a),parseInt(t)+o++])if(document[e][l]=h,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing){if(document.aBattleBoard[l]>=iLightFreshKing&&document.aBattleBoard[l]<=iLightMovedKing)h=999.2;else break}break;case iDarkFreshRook:case iDarkMovedRook:for(o=1,h=iValidMoveSimple,r=[parseInt(a)-o++,parseInt(t)];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)-o++,parseInt(t)])if(document[e][l]=h,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing){if(document.aBattleBoard[l]>=iLightFreshKing&&document.aBattleBoard[l]<=iLightMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a),parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a),parseInt(t)-o++])if(document[e][l]=h,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing){if(document.aBattleBoard[l]>=iLightFreshKing&&document.aBattleBoard[l]<=iLightMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a)+o++,parseInt(t)];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)+o++,parseInt(t)])if(document[e][l]=h,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing){if(document.aBattleBoard[l]>=iLightFreshKing&&document.aBattleBoard[l]<=iLightMovedKing)h=999.2;else break}for(o=1,h=iValidMoveSimple,r=[parseInt(a),parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a),parseInt(t)+o++])if(document[e][l]=h,document.aBattleBoard[l]>=iLightPawn&&document.aBattleBoard[l]<=iLightMovedKing){if(document.aBattleBoard[l]>=iLightFreshKing&&document.aBattleBoard[l]<=iLightMovedKing)h=999.2;else break}break;case iDarkFreshKing:case iDarkMovedKing:for(h=iValidMoveSimple,r=[parseInt(a)-o,parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)-o,parseInt(t)-o++]){document[e][l]=h;break}for(o=1,r=[parseInt(a)+o,parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)+o,parseInt(t)-o++]){document[e][l]=h;break}for(o=1,r=[parseInt(a)-o,parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)-o,parseInt(t)+o++]){document[e][l]=h;break}for(o=1,r=[parseInt(a)+o,parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)+o,parseInt(t)+o++]){document[e][l]=h;break}for(o=1,r=[parseInt(a)-o++,parseInt(t)];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)-o++,parseInt(t)]){document[e][l]=h;break}for(o=1,r=[parseInt(a),parseInt(t)-o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a),parseInt(t)-o++]){document[e][l]=h;break}for(o=1,r=[parseInt(a)+o++,parseInt(t)];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a)+o++,parseInt(t)]){document[e][l]=h;break}for(o=1,r=[parseInt(a),parseInt(t)+o++];r[0]+8*r[1]>=0&&r[0]+8*r[1]<document.aBattleBoard.length&&r[0]>=0&&r[0]<=7&&r[1]>=0&&r[1]<=7&&(l=r[0]+8*r[1],!(document.aBattleBoard[l]>=iDarkPawn)||!(document.aBattleBoard[l]<=iDarkMovedKing));r=[parseInt(a),parseInt(t)+o++]){document[e][l]=h;break}fClearValidMoves("aControlledOverlay");for(let C=0;C<8;C++)for(let A=0;A<8;A++)switch(l=C+8*A,document.aBattleBoard[l]){case iLightPawn:case iLightBishop:case iLightKnight:case iLightFreshRook:case iLightMovedRook:case iLightQueen:fMarkValidMoves(C,A,"aControlledOverlay",!0)}for(let X=0;X<document.aControlledOverlay.length;X++)0!=document.aControlledOverlay[X]&&999.1!=document.aControlledOverlay[X]&&(document.aMoveOverlay[X]=0);document.aBattleBoard[parseInt(a)+8*parseInt(t)]==iDarkFreshKing&&(0==document.aBattleBoard[parseInt(a)+8*parseInt(t)-1]&&0==document.aControlledOverlay[parseInt(a)+8*parseInt(t)-1]&&0==document.aBattleBoard[parseInt(a)+8*parseInt(t)-2]&&0==document.aControlledOverlay[parseInt(a)+8*parseInt(t)-2]&&document.aBattleBoard[parseInt(a)+8*parseInt(t)-3]==iDarkFreshRook&&(document[e][parseInt(a)+8*parseInt(t)-2]=999.3),0==document.aBattleBoard[parseInt(a)+8*parseInt(t)+1]&&0==document.aControlledOverlay[parseInt(a)+8*parseInt(t)+1]&&0==document.aBattleBoard[parseInt(a)+8*parseInt(t)+2]&&0==document.aControlledOverlay[parseInt(a)+8*parseInt(t)+2]&&0==document.aBattleBoard[parseInt(a)+8*parseInt(t)+3]&&document.aBattleBoard[parseInt(a)+8*parseInt(t)+4]==iDarkFreshRook&&(document[e][parseInt(a)+8*parseInt(t)+2]=999.3))}callstack-=1}function Tick(a){}function fNewGame(){fInitializeGame(),fBattle()}function fBattle(){let a=document.oRuntime.objects.BattleMarker.getFirstInstance();a&&(a.isVisible=!1),document.oRuntime.goToLayout("Battle Board")}function fMainMenu(){document.oRuntime.goToLayout("Intro Splash")}function fDungeon(){let a=document.oRuntime.objects.DungeonMarker.getFirstInstance();a&&(a.isVisible=!1),document.oRuntime.goToLayout("Dungeon")}function fEvent_Click(a,t){try{document.clicking=!0,fSetMarker(a)}catch(e){alert(e)}}function fEvent_TouchEnd(a,t){a.touches[0];let e=new MouseEvent("click",{});document.touching=!0,t.dispatchEvent(e)}function fEvent_MouseMove(a,t){try{fSetMarker(a)}catch(e){alert(e)}}function fEvent_TouchStart(a,t){let e=a.touches[0];document.touchX=e.clientX,document.touchY=e.clientY}function fEvent_TouchMove(a,t){let e=a.touches[0];document.touchX=e.clientX,document.touchY=e.clientY}function fSetMarker(a){let t=null,e=null,i=!1;switch(document.oRuntime.layout.name){case"Battle Board":t=document.oRuntime.objects.BattleMarker.getFirstInstance(),e=document.oRuntime.objects.BattleSelection.getFirstInstance(),refreshBounds(document.oRuntime.layout.name);let o=a.x,l=a.y;if(document.touching&&document.clicking&&null!=document.touchX&&null!=document.touchY&&(o=document.touchX,l=document.touchY),o>=document.dMinX&&o<=document.dMaxX&&l>=document.dMinY&&l<=document.dMaxY){let r=Math.floor((o-document.dMinX)/(document.dWidth/8)),n=Math.floor((l-document.dMinY)/(document.dHeight/8));t.x=(r+1)*60+157,t.y=(n+0)*60+0+30,i=!0;let B=r;if(r=7-n,n=7-B,e.isVisible||(fMarkValidMoves(r,n),document.fRenderValidMoves()),t.isVisible||(t.isVisible=!0),document.clicking){if(e.x==t.x&&e.y==t.y&&e.isVisible&&!document.touching)e.isVisible=!1,e.x=-256,e.y=-256;else if(fIsValidMove(document.aMoveOverlay[r+8*n])){switch(document.aBattleBoardHistory.unshift(JSON.parse(JSON.stringify(document.aBattleBoard))),document.aBattleBoardSprites[r+8*n]&&(document.aBattleBoardSprites[r+8*n].destroy(),document.aBattleBoardSprites[r+8*n]=null),document.aBattleBoard[r+8*n]=document.aBattleBoard[e.markerX+8*e.markerY],document.aBattleBoard[e.markerX+8*e.markerY]=0,document.aBattleBoard[r+8*n]){case iLightFreshRook:case iLightFreshKing:case iDarkFreshRook:case iDarkFreshKing:document.aBattleBoard[r+8*n]=document.aBattleBoard[r+8*n]+1}if(999.3==document.aMoveOverlay[r+8*n]&&((document.aBattleBoard[r+8*n-1]==iLightFreshRook||document.aBattleBoard[r+8*n-1]==iDarkFreshRook)&&(document.aBattleBoard[r+8*n+1]=document.aBattleBoard[r+8*n-1]+1,document.aBattleBoard[r+8*n-1]=0,document.aBattleBoardSprites[r+8*n-1]&&(document.aBattleBoardSprites[r+8*n-1].destroy(),document.aBattleBoardSprites[r+8*n-1]=null,document.fRenderLayout(r+8*n+1))),(document.aBattleBoard[r+8*n+2]==iLightFreshRook||document.aBattleBoard[r+8*n+2]==iDarkFreshRook)&&(document.aBattleBoard[r+8*n-1]=document.aBattleBoard[r+8*n+2]+1,document.aBattleBoard[r+8*n+2]=0,document.aBattleBoardSprites[r+8*n+2]&&(document.aBattleBoardSprites[r+8*n+2].destroy(),document.aBattleBoardSprites[r+8*n+2]=null,document.fRenderLayout(r+8*n-1)))),document.aBattleBoardSprites[parseInt(e.markerX)+parseInt(8*e.markerY)]&&(document.aBattleBoardSprites[parseInt(e.markerX)+parseInt(8*e.markerY)].destroy(),document.aBattleBoardSprites[parseInt(e.markerX)+parseInt(8*e.markerY)]=null),document.aMoveOverlay[r+8*n]>=1e3&&document.aMoveOverlay[r+8*n]<=1999){let $=document.aMoveOverlay[r+8*n]-1e3;document.aBattleBoard[$]=0,document.aBattleBoardSprites[$]&&(document.aBattleBoardSprites[$].destroy(),document.aBattleBoardSprites[$]=null)}document.fRenderLayout(r+8*n),i=!1}else document.aBattleBoard[r+8*n]>=iLightPawn&&document.aBattleBoard[r+8*n]<=iLightMovedKing||document.aBattleBoard[r+8*n]>=iDarkPawn&&document.aBattleBoard[r+8*n]<=iDarkMovedKing?(fMarkValidMoves(r,n),document.fRenderValidMoves(),e.x=t.x,e.y=t.y,e.isVisible=!0,e.markerX=r,e.markerY=n):i=!1}}if(!i&&t.isVisible){t.isVisible=!1,e.isVisible=!1,fClearValidMoves();let d=document.oRuntime.objects.ValidDestination.getAllInstances();for(let g=1;g<d.length;g++){let _=d[g];_.isVisible=!1,_.gone=!0,_.destroy()}}document.touching=!1,document.clicking=!1;break;case"Dungeon":if(t=document.oRuntime.objects.DungeonMarker.getFirstInstance(),refreshBounds(document.oRuntime.layout.name),a.x>=document.dMinX&&a.x<=document.dMaxX&&a.y>=document.dMinY&&a.y<=document.dMaxY){t.isVisible||(t.isVisible=!0);let s=Math.floor((a.x-document.dMinX)/(document.dWidth/7)),h=Math.floor((a.y-document.dMinY)/(document.dHeight/6));t.x=(s+1)*60+180,t.y=(h+0)*60+0+89,i=!0}i||!t.isVisible||document.touching||(t.isVisible=!1),document.touching=!1}}