function refreshBounds(e){if("Battle Board"==e){let t=document.oWindow.innerWidth/2,a=document.oWindow.innerHeight/2,n=document.oRuntime.viewportWidth/2,i=document.oRuntime.viewportHeight/2,l=t/n,o=a/i;try{let r=document.oWindow.innerWidth/2,s=480*l;o<l&&(s=480*o);let $=(r-=s/2)+s;document.dMinX=r,document.dMaxX=$,document.dMinY=document.oWindow.innerHeight/2-s/2,document.dMaxY=document.oWindow.innerHeight/2+s/2,document.dWidth=document.dMaxX-document.dMinX,document.dHeight=document.dMaxY-document.dMinY,document.dBoardWidth=s}catch(u){alert(u)}}else if("Dungeon"==e){let c=document.oWindow.innerWidth/2,g=document.oWindow.innerHeight/2,d=document.oRuntime.viewportWidth/2,h=document.oRuntime.viewportHeight/2,B=c/d,v=g/h;try{let f=document.oWindow.innerWidth/2,k=420*B,_=360*B;v<B&&(k=420*v,_=420*v);let b=(f-=k/2)+k;document.dMinX=f,document.dMaxX=b,document.dMinY=document.oWindow.innerHeight/2-_/2,document.dMaxY=document.oWindow.innerHeight/2+_/2,document.dWidth=document.dMaxX-document.dMinX,document.dHeight=document.dMaxY-document.dMinY,document.dBoardWidth=k,document.dBoardHeight=_}catch(M){alert(M)}}}async function OnBeforeProjectStart(e){e.addEventListener("tick",()=>Tick(e)),document.oRuntime=e,document.oCanvas=document.getElementsByTagName("canvas")[0],document.oWindow=window,refreshBounds(document.oRuntime.layout.name),document.oCanvas.addEventListener("click",function(e){fEvent_Click(e,document.oCanvas)}),document.oCanvas.addEventListener("touchstart",function(e){fEvent_TouchStart(e,document.oCanvas)}),document.oCanvas.addEventListener("touchend",function(e){fEvent_TouchEnd(e,document.oCanvas)}),document.oCanvas.addEventListener("mousemove",function(e){fEvent_MouseMove(e,document.oCanvas)}),document.oCanvas.addEventListener("touchmove",function(e){fEvent_TouchMove(e,document.oCanvas)}),document.btnListeners=!1,document.fRenderLayout=function(e){let t=!1;if(e>=0?t=!0:e=0,"Battle Board"===document.oRuntime.layout.name){refreshBounds(document.oRuntime.layout.name);try{for(let a=e;a<document.aBattleBoard.length;a++){let n=Math.floor(a/8),i=a%8,l=157+(8-n)*60,o=-30+(8-i)*60,r=null;switch(document.aBattleBoard[a]){case iLightPawn:r=document.oRuntime.objects.LightPawn;break;case iLightBishop:r=document.oRuntime.objects.LightBishop;break;case iLightKnight:r=document.oRuntime.objects.LightKnight;break;case iLightRook:r=document.oRuntime.objects.LightRook;break;case iLightQueen:r=document.oRuntime.objects.LightQueen;break;case iLightKing:r=document.oRuntime.objects.LightKing;break;case iDarkPawn:r=document.oRuntime.objects.DarkPawn;break;case iDarkBishop:r=document.oRuntime.objects.DarkBishop;break;case iDarkKnight:r=document.oRuntime.objects.DarkKnight;break;case iDarkRook:r=document.oRuntime.objects.DarkRook;break;case iDarkQueen:r=document.oRuntime.objects.DarkQueen;break;case iDarkKing:r=document.oRuntime.objects.DarkKing}r&&(document.aBattleBoardSprites[parseInt(i)+parseInt(8*n)]=r.createInstance(0,l,o)),t&&(a=document.aBattleBoard.length)}for(let s=1;s<document.oRuntime.objects.LightPawn.getAllInstances().length;s++)document.oRuntime.objects.LightPawn.getAllInstances()[s].isVisible=!0;for(let $=1;$<document.oRuntime.objects.LightBishop.getAllInstances().length;$++)document.oRuntime.objects.LightBishop.getAllInstances()[$].isVisible=!0;for(let u=1;u<document.oRuntime.objects.LightKnight.getAllInstances().length;u++)document.oRuntime.objects.LightKnight.getAllInstances()[u].isVisible=!0;for(let c=1;c<document.oRuntime.objects.LightRook.getAllInstances().length;c++)document.oRuntime.objects.LightRook.getAllInstances()[c].isVisible=!0;for(let g=1;g<document.oRuntime.objects.LightQueen.getAllInstances().length;g++)document.oRuntime.objects.LightQueen.getAllInstances()[g].isVisible=!0;for(let d=1;d<document.oRuntime.objects.LightKing.getAllInstances().length;d++)document.oRuntime.objects.LightKing.getAllInstances()[d].isVisible=!0;for(let h=1;h<document.oRuntime.objects.DarkPawn.getAllInstances().length;h++)document.oRuntime.objects.DarkPawn.getAllInstances()[h].isVisible=!0;for(let B=1;B<document.oRuntime.objects.DarkBishop.getAllInstances().length;B++)document.oRuntime.objects.DarkBishop.getAllInstances()[B].isVisible=!0;for(let v=1;v<document.oRuntime.objects.DarkKnight.getAllInstances().length;v++)document.oRuntime.objects.DarkKnight.getAllInstances()[v].isVisible=!0;for(let f=1;f<document.oRuntime.objects.DarkRook.getAllInstances().length;f++)document.oRuntime.objects.DarkRook.getAllInstances()[f].isVisible=!0;for(let k=1;k<document.oRuntime.objects.DarkQueen.getAllInstances().length;k++)document.oRuntime.objects.DarkQueen.getAllInstances()[k].isVisible=!0;for(let _=1;_<document.oRuntime.objects.DarkKing.getAllInstances().length;_++)document.oRuntime.objects.DarkKing.getAllInstances()[_].isVisible=!0;if(!t){let b=document.oRuntime.objects.DungeonEntrance.getAllInstances();for(let M=1;M<b.length;M++){let m=b[M];m.isVisible=!1,m.gone=!0,m.destroy()}for(let y=0;y<document.aEntranceOverlay.length;y++){let R=Math.floor(y/8),D=y%8,w=157+(8-R)*60,L=-30+(8-D)*60;if(document.aEntranceOverlay[y]==iDungeonEntrance){document.oRuntime.objects.DungeonEntrance.createInstance(0,w,L);break}}for(let j=1;j<document.oRuntime.objects.DungeonEntrance.getAllInstances().length;j++)document.oRuntime.objects.DungeonEntrance.getAllInstances()[j].isVisible=!0}}catch(V){alert(V)}}},document.fRenderValidMoves=function(){if("Battle Board"===document.oRuntime.layout.name){refreshBounds(document.oRuntime.layout.name);try{let e=document.oRuntime.objects.ValidDestination.getAllInstances();for(let t=1;t<e.length;t++){let a=e[t];a.isVisible=!1,a.gone=!0,a.destroy()}for(let n=0;n<document.aMoveOverlay.length;n++){let i=Math.floor(n/8),l=n%8,o=157+(8-i)*60,r=-30+(8-l)*60;fIsValidMove(document.aMoveOverlay[n])&&document.oRuntime.objects.ValidDestination.createInstance(0,o,r)}for(let s=1;s<document.oRuntime.objects.ValidDestination.getAllInstances().length;s++){let $=document.oRuntime.objects.ValidDestination.getAllInstances()[s];$.gone||($.isVisible=!0)}}catch(u){alert(u)}}},document.fClick=function(e){let t=e.getAttribute("op");switch(t){case"NEW_GAME":fNewGame();break;case"MAIN_MENU":fMainMenu();break;case"GO_TO_DUNGEON":fDungeon();break;case"GO_TO_BATTLE":case"RESUME":fBattle()}}}runOnStartup(async e=>{e.addEventListener("beforeprojectstart",()=>OnBeforeProjectStart(e))});const iLightPawn=1,iLightBishop=2,iLightKnight=3,iLightRook=4,iLightQueen=5,iLightKing=6,iDarkPawn=7,iDarkBishop=8,iDarkKnight=9,iDarkRook=10,iDarkQueen=11,iDarkKing=12,iDungeonEntrance=100,iValidMoveSimple=999,iValidMoveStart=1e3,iValidMoveEnd=1999;function fIsValidMove(e){return e>=999&&e<=1999}function fClearValidMoves(){document.aMoveOverlay=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,]}function fInitializeGame(){document.aBattleBoardHistory=[],document.aBattleBoardSprites=[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],document.aBattleBoard=[0,0,0,iDarkKing,0,0,0,0,iDarkPawn,0,0,iDarkPawn,iDarkPawn,0,0,0,0,0,0,0,0,0,0,0,0,iDarkPawn,iDarkPawn,0,0,0,0,0,0,iLightPawn,0,0,0,0,iDarkPawn,0,iLightPawn,0,0,0,0,iDarkPawn,0,iDarkPawn,0,0,iLightPawn,iLightPawn,iLightPawn,iLightPawn,iLightPawn,iLightPawn,0,0,0,iLightKing,0,0,0,0],document.aEntranceOverlay=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,];let e=0;for(let t=0;t<document.aEntranceOverlay.length;t++)-1==document.aEntranceOverlay[t]&&(e+=1);let a=Math.floor(Math.random()*e);e=0;for(let n=0;n<document.aEntranceOverlay.length;n++)if(-1==document.aEntranceOverlay[n]){if(e==a){document.aEntranceOverlay[n]=iDungeonEntrance;break}e+=1}fClearValidMoves(),document.bLightKingMoved=!1,document.bDarkKingMoved=!1}function fMarkValidMoves(e,t){fClearValidMoves();let a=parseInt(e)+8*parseInt(t),n=null,i=null,l=null,o=null;switch(document.aBattleBoard[a]){case iLightPawn:if(n=[parseInt(e),parseInt(t)-1],i=[parseInt(e),parseInt(t)-2],l=[parseInt(e)-1,parseInt(t)-1],o=[parseInt(e)+1,parseInt(t)-1],(a=n[0]+8*n[1])<document.aMoveOverlay.length&&a>=0&&0==document.aBattleBoard[a]&&(document.aMoveOverlay[a]=999,6==t&&(a=i[0]+8*i[1])<document.aMoveOverlay.length&&a>=0&&0==document.aBattleBoard[a]&&(document.aMoveOverlay[a]=999)),(a=l[0]+8*l[1])<document.aMoveOverlay.length&&a>=0){if(document.aBattleBoard[a]>=iDarkPawn&&document.aBattleBoard[a]<=iDarkKing)document.aMoveOverlay[a]=999;else if(0==document.aBattleBoard[a]&&3==t&&document.aBattleBoardHistory.length>=1){let r=document.aBattleBoardHistory[0],s=[parseInt(e)-1,parseInt(t)-2],$=[parseInt(e)-1,parseInt(t)],u=s[0]+8*s[1],c=$[0]+8*$[1];r[u]==iDarkPawn&&0==r[c]&&0==document.aBattleBoard[u]&&document.aBattleBoard[c]==iDarkPawn&&0==document.aMoveOverlay[a]&&(document.aMoveOverlay[a]=1e3+c)}}if((a=o[0]+8*o[1])<document.aMoveOverlay.length&&a>=0){if(document.aBattleBoard[a]>=iDarkPawn&&document.aBattleBoard[a]<=iDarkKing)document.aMoveOverlay[a]=999;else if(0==document.aBattleBoard[a]&&3==t&&document.aBattleBoardHistory.length>=1){let g=document.aBattleBoardHistory[0],d=[parseInt(e)+1,parseInt(t)-2],h=[parseInt(e)+1,parseInt(t)],B=d[0]+8*d[1],v=h[0]+8*h[1];g[B]==iDarkPawn&&0==g[v]&&0==document.aBattleBoard[B]&&document.aBattleBoard[v]==iDarkPawn&&0==document.aMoveOverlay[a]&&(document.aMoveOverlay[a]=1e3+v)}}break;case iDarkPawn:if(n=[parseInt(e),parseInt(t)+1],i=[parseInt(e),parseInt(t)+2],l=[parseInt(e)-1,parseInt(t)+1],o=[parseInt(e)+1,parseInt(t)+1],(a=n[0]+8*n[1])<document.aMoveOverlay.length&&a>=0&&0==document.aBattleBoard[a]&&(document.aMoveOverlay[a]=999,1==t&&(a=i[0]+8*i[1])<document.aMoveOverlay.length&&a>=0&&0==document.aBattleBoard[a]&&(document.aMoveOverlay[a]=999)),(a=l[0]+8*l[1])<document.aMoveOverlay.length&&a>=0){if(document.aBattleBoard[a]>=iLightPawn&&document.aBattleBoard[a]<=iLightKing)document.aMoveOverlay[a]=999;else if(0==document.aBattleBoard[a]&&4==t&&document.aBattleBoardHistory.length>=1){let f=document.aBattleBoardHistory[0],k=[parseInt(e)-1,parseInt(t)+2],_=[parseInt(e)-1,parseInt(t)],b=k[0]+8*k[1],M=_[0]+8*_[1];f[b]==iLightPawn&&0==f[M]&&0==document.aBattleBoard[b]&&document.aBattleBoard[M]==iLightPawn&&0==document.aMoveOverlay[a]&&(document.aMoveOverlay[a]=1e3+M)}}if((a=o[0]+8*o[1])<document.aMoveOverlay.length&&a>=0){if(document.aBattleBoard[a]>=iLightPawn&&document.aBattleBoard[a]<=iLightKing)document.aMoveOverlay[a]=999;else if(0==document.aBattleBoard[a]&&4==t&&document.aBattleBoardHistory.length>=1){let m=document.aBattleBoardHistory[0],y=[parseInt(e)+1,parseInt(t)+2],R=[parseInt(e)+1,parseInt(t)],D=y[0]+8*y[1],w=R[0]+8*R[1];m[D]==iLightPawn&&0==m[w]&&0==document.aBattleBoard[D]&&document.aBattleBoard[w]==iLightPawn&&0==document.aMoveOverlay[a]&&(document.aMoveOverlay[a]=1e3+w)}}}}function Tick(e){}function fNewGame(){fInitializeGame(),fBattle()}function fBattle(){let e=document.oRuntime.objects.BattleMarker.getFirstInstance();e&&(e.isVisible=!1),document.oRuntime.goToLayout("Battle Board")}function fMainMenu(){document.oRuntime.goToLayout("Intro Splash")}function fDungeon(){let e=document.oRuntime.objects.DungeonMarker.getFirstInstance();e&&(e.isVisible=!1),document.oRuntime.goToLayout("Dungeon")}function fEvent_Click(e,t){try{document.clicking=!0,fSetMarker(e)}catch(a){alert(a)}}function fEvent_TouchStart(e,t){let a=e.touches[0],n=new MouseEvent("mousemove",{clientX:a.clientX,clientY:a.clientY});document.touching=!0,t.dispatchEvent(n)}function fEvent_TouchEnd(e,t){e.touches[0];let a=new MouseEvent("click",{});document.touching=!0,t.dispatchEvent(a)}function fEvent_MouseMove(e,t){try{fSetMarker(e)}catch(a){alert(a)}}function fEvent_TouchMove(e,t){let a=e.touches[0],n=new MouseEvent("mousemove",{clientX:a.clientX,clientY:a.clientY});document.touching=!0,t.dispatchEvent(n)}function fSetMarker(e){let t=null,a=null,n=!1;switch(document.oRuntime.layout.name){case"Battle Board":if(t=document.oRuntime.objects.BattleMarker.getFirstInstance(),a=document.oRuntime.objects.BattleSelection.getFirstInstance(),refreshBounds(document.oRuntime.layout.name),e.x>=document.dMinX&&e.x<=document.dMaxX&&e.y>=document.dMinY&&e.y<=document.dMaxY){let i=Math.floor((e.x-document.dMinX)/(document.dWidth/8)),l=Math.floor((e.y-document.dMinY)/(document.dHeight/8));t.x=(i+1)*60+157,t.y=(l+0)*60+0+30,n=!0;let o=i;if(i=7-l,l=7-o,a.isVisible||(fMarkValidMoves(i,l),document.fRenderValidMoves()),t.isVisible||(t.isVisible=!0),document.clicking){if(a.x==t.x&&a.y==t.y&&a.isVisible)a.isVisible=!1,a.x=-256,a.y=-256;else if(fIsValidMove(document.aMoveOverlay[i+8*l])){if(document.aBattleBoardHistory.unshift(JSON.parse(JSON.stringify(document.aBattleBoard))),document.aBattleBoardSprites[i+8*l]&&(document.aBattleBoardSprites[i+8*l].destroy(),document.aBattleBoardSprites[i+8*l]=null),document.aBattleBoard[i+8*l]=document.aBattleBoard[a.markerX+8*a.markerY],document.aBattleBoard[a.markerX+8*a.markerY]=0,document.aBattleBoardSprites[parseInt(a.markerX)+parseInt(8*a.markerY)]&&(document.aBattleBoardSprites[parseInt(a.markerX)+parseInt(8*a.markerY)].destroy(),document.aBattleBoardSprites[parseInt(a.markerX)+parseInt(8*a.markerY)]=null),document.aMoveOverlay[i+8*l]>=1e3&&document.aMoveOverlay[i+8*l]<=1999){let r=document.aMoveOverlay[i+8*l]-1e3;document.aBattleBoard[r]=0,document.aBattleBoardSprites[r]&&(document.aBattleBoardSprites[r].destroy(),document.aBattleBoardSprites[r]=null)}document.fRenderLayout(i+8*l),n=!1}else document.aBattleBoard[i+8*l]>=iLightPawn&&document.aBattleBoard[i+8*l]<=iLightKing||document.aBattleBoard[i+8*l]>=iDarkPawn&&document.aBattleBoard[i+8*l]<=iDarkKing?(fMarkValidMoves(i,l),document.fRenderValidMoves(),a.x=t.x,a.y=t.y,a.isVisible=!0,a.markerX=i,a.markerY=l):n=!1}}if(!n&&t.isVisible&&!document.touching){t.isVisible=!1,a.isVisible=!1,fClearValidMoves();let s=document.oRuntime.objects.ValidDestination.getAllInstances();for(let $=1;$<s.length;$++){let u=s[$];u.isVisible=!1,u.gone=!0,u.destroy()}}document.touching=!1,document.clicking=!1;break;case"Dungeon":if(t=document.oRuntime.objects.DungeonMarker.getFirstInstance(),refreshBounds(document.oRuntime.layout.name),e.x>=document.dMinX&&e.x<=document.dMaxX&&e.y>=document.dMinY&&e.y<=document.dMaxY){t.isVisible||(t.isVisible=!0);let c=Math.floor((e.x-document.dMinX)/(document.dWidth/7)),g=Math.floor((e.y-document.dMinY)/(document.dHeight/6));t.x=(c+1)*60+180,t.y=(g+0)*60+0+89,n=!0}n||!t.isVisible||document.touching||(t.isVisible=!1),document.touching=!1}}document.aBattleBoardHistory=null,document.aBattleBoard=null,document.aEntranceOverlay=null,document.aMoveOverlay=null,document.bLightKingMoved=!1,document.bDarkKingMoved=!1,document.aBattleBoardSprites=null;