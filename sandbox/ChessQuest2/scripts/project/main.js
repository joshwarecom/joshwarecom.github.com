function refreshBounds(e){if("Battle Board"==e){let t=document.oWindow.innerWidth/2,n=document.oWindow.innerHeight/2,i=document.oRuntime.viewportWidth/2,a=document.oRuntime.viewportHeight/2,o=t/i,l=n/a;try{let $=document.oWindow.innerWidth/2,s=480*o;l<o&&(s=480*l);let r=($-=s/2)+s;document.dMinX=$,document.dMaxX=r,document.dMinY=document.oWindow.innerHeight/2-s/2,document.dMaxY=document.oWindow.innerHeight/2+s/2,document.dWidth=document.dMaxX-document.dMinX,document.dHeight=document.dMaxY-document.dMinY,document.dBoardWidth=s}catch(c){alert(c)}}else if("Dungeon"==e){let g=document.oWindow.innerWidth/2,u=document.oWindow.innerHeight/2,h=document.oRuntime.viewportWidth/2,d=document.oRuntime.viewportHeight/2,v=g/h,f=u/d;try{let b=document.oWindow.innerWidth/2,M=420*v,k=360*v;f<v&&(M=420*f,k=420*f);let m=(b-=M/2)+M;document.dMinX=b,document.dMaxX=m,document.dMinY=document.oWindow.innerHeight/2-k/2,document.dMaxY=document.oWindow.innerHeight/2+k/2,document.dWidth=document.dMaxX-document.dMinX,document.dHeight=document.dMaxY-document.dMinY,document.dBoardWidth=M,document.dBoardHeight=k}catch(R){alert(R)}}}async function OnBeforeProjectStart(e){e.addEventListener("tick",()=>Tick(e)),document.oRuntime=e,document.oCanvas=document.getElementsByTagName("canvas")[0],document.oWindow=window,refreshBounds(document.oRuntime.layout.name),document.oCanvas.addEventListener("click",function(e){fEvent_Click(e,document.oCanvas)}),document.oCanvas.addEventListener("touchstart",function(e){fEvent_TouchStart(e,document.oCanvas)}),document.oCanvas.addEventListener("mousemove",function(e){fEvent_MouseMove(e,document.oCanvas)}),document.oCanvas.addEventListener("touchmove",function(e){fEvent_TouchMove(e,document.oCanvas)}),document.btnListeners=!1,document.fRenderLayout=function(){if("Battle Board"===document.oRuntime.layout.name){refreshBounds(document.oRuntime.layout.name);try{for(let e=0;e<document.aBattleBoard.length;e++){let t=Math.floor(e/8),n=e%8,i=157+(8-t)*60,a=-30+(8-n)*60,o=null;switch(document.aBattleBoard[e]){case iLightPawn:o=document.oRuntime.objects.LightPawn;break;case iLightBishop:o=document.oRuntime.objects.LightBishop;break;case iLightKnight:o=document.oRuntime.objects.LightKnight;break;case iLightRook:o=document.oRuntime.objects.LightRook;break;case iLightQueen:o=document.oRuntime.objects.LightQueen;break;case iLightKing:o=document.oRuntime.objects.LightKing;break;case iDarkPawn:o=document.oRuntime.objects.DarkPawn;break;case iDarkBishop:o=document.oRuntime.objects.DarkBishop;break;case iDarkKnight:o=document.oRuntime.objects.DarkKnight;break;case iDarkRook:o=document.oRuntime.objects.DarkRook;break;case iDarkQueen:o=document.oRuntime.objects.DarkQueen;break;case iDarkKing:o=document.oRuntime.objects.DarkKing}o&&o.createInstance(0,i,a)}for(let l=1;l<document.oRuntime.objects.LightPawn.getAllInstances().length;l++)document.oRuntime.objects.LightPawn.getAllInstances()[l].isVisible=!0;for(let $=1;$<document.oRuntime.objects.LightBishop.getAllInstances().length;$++)document.oRuntime.objects.LightBishop.getAllInstances()[$].isVisible=!0;for(let s=1;s<document.oRuntime.objects.LightKnight.getAllInstances().length;s++)document.oRuntime.objects.LightKnight.getAllInstances()[s].isVisible=!0;for(let r=1;r<document.oRuntime.objects.LightRook.getAllInstances().length;r++)document.oRuntime.objects.LightRook.getAllInstances()[r].isVisible=!0;for(let c=1;c<document.oRuntime.objects.LightQueen.getAllInstances().length;c++)document.oRuntime.objects.LightQueen.getAllInstances()[c].isVisible=!0;for(let g=1;g<document.oRuntime.objects.LightKing.getAllInstances().length;g++)document.oRuntime.objects.LightKing.getAllInstances()[g].isVisible=!0;for(let u=1;u<document.oRuntime.objects.DarkPawn.getAllInstances().length;u++)document.oRuntime.objects.DarkPawn.getAllInstances()[u].isVisible=!0;for(let h=1;h<document.oRuntime.objects.DarkBishop.getAllInstances().length;h++)document.oRuntime.objects.DarkBishop.getAllInstances()[h].isVisible=!0;for(let d=1;d<document.oRuntime.objects.DarkKnight.getAllInstances().length;d++)document.oRuntime.objects.DarkKnight.getAllInstances()[d].isVisible=!0;for(let v=1;v<document.oRuntime.objects.DarkRook.getAllInstances().length;v++)document.oRuntime.objects.DarkRook.getAllInstances()[v].isVisible=!0;for(let f=1;f<document.oRuntime.objects.DarkQueen.getAllInstances().length;f++)document.oRuntime.objects.DarkQueen.getAllInstances()[f].isVisible=!0;for(let b=1;b<document.oRuntime.objects.DarkKing.getAllInstances().length;b++)document.oRuntime.objects.DarkKing.getAllInstances()[b].isVisible=!0;for(let M=0;M<document.aEntranceOverlay.length;M++){let k=Math.floor(M/8),m=M%8,R=157+(8-k)*60,_=-30+(8-m)*60;if(document.aEntranceOverlay[M]==iDungeonEntrance){document.oRuntime.objects.DungeonEntrance.createInstance(0,R,_);break}}for(let B=1;B<document.oRuntime.objects.DungeonEntrance.getAllInstances().length;B++)document.oRuntime.objects.DungeonEntrance.getAllInstances()[B].isVisible=!0}catch(D){alert(D)}}},document.fRenderValidMoves=function(){if("Battle Board"===document.oRuntime.layout.name){refreshBounds(document.oRuntime.layout.name);try{let e=document.oRuntime.objects.ValidDestination.getAllInstances();for(let t=1;t<e.length;t++){let n=e[t];n.isVisible=!1,n.gone=!0,n.destroy()}for(let i=0;i<document.aMoveOverlay.length;i++){let a=Math.floor(i/8),o=i%8,l=157+(8-a)*60,$=-30+(8-o)*60;document.aMoveOverlay[i]==iValidMove&&document.oRuntime.objects.ValidDestination.createInstance(0,l,$)}for(let s=1;s<document.oRuntime.objects.ValidDestination.getAllInstances().length;s++){let r=document.oRuntime.objects.ValidDestination.getAllInstances()[s];r.gone||(r.isVisible=!0)}}catch(c){alert(c)}}},document.fClick=function(e){let t=e.getAttribute("op");switch(t){case"NEW_GAME":fNewGame();break;case"MAIN_MENU":fMainMenu();break;case"GO_TO_DUNGEON":fDungeon();break;case"GO_TO_BATTLE":case"RESUME":fBattle()}}}runOnStartup(async e=>{e.addEventListener("beforeprojectstart",()=>OnBeforeProjectStart(e))});const iLightPawn=1,iLightBishop=2,iLightKnight=3,iLightRook=4,iLightQueen=5,iLightKing=6,iDarkPawn=7,iDarkBishop=8,iDarkKnight=9,iDarkRook=10,iDarkQueen=11,iDarkKing=12,iDungeonEntrance=100,iValidMove=101;function fClearValidMoves(){document.aMoveOverlay=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,]}function fInitializeGame(){document.aBattleBoard=[0,0,0,iDarkKing,0,0,0,0,iDarkPawn,0,0,0,iDarkPawn,0,0,0,0,0,0,iDarkPawn,0,0,0,0,0,iDarkPawn,iDarkPawn,0,0,0,0,0,0,iLightPawn,0,0,0,0,iDarkPawn,0,iLightPawn,0,0,0,0,iDarkPawn,0,iDarkPawn,0,0,iLightPawn,iLightPawn,iLightPawn,iLightPawn,iLightPawn,iLightPawn,0,0,0,iLightKing,0,0,0,0],document.aEntranceOverlay=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,];let e=0;for(let t=0;t<document.aEntranceOverlay.length;t++)-1==document.aEntranceOverlay[t]&&(e+=1);let n=Math.floor(Math.random()*e);e=0;for(let i=0;i<document.aEntranceOverlay.length;i++)if(-1==document.aEntranceOverlay[i]){if(e==n){document.aEntranceOverlay[i]=iDungeonEntrance;break}e+=1}fClearValidMoves(),document.bLightKingMoved=!1,document.bDarkKingMoved=!1}function fMarkValidMoves(e,t){fClearValidMoves();let n=parseInt(e)+8*parseInt(t),i=null,a=null,o=null,l=null;switch(document.aBattleBoard[n]){case iLightPawn:i=[parseInt(e),parseInt(t)-1],a=[parseInt(e),parseInt(t)-2],o=[parseInt(e)-1,parseInt(t)-1],l=[parseInt(e)+1,parseInt(t)-1],(n=i[0]+8*i[1])<document.aMoveOverlay.length&&n>=0&&0==document.aBattleBoard[n]&&(document.aMoveOverlay[n]=iValidMove,6==t&&(n=a[0]+8*a[1])<document.aMoveOverlay.length&&n>=0&&0==document.aBattleBoard[n]&&(document.aMoveOverlay[n]=iValidMove)),(n=o[0]+8*o[1])<document.aMoveOverlay.length&&n>=0&&document.aBattleBoard[n]>=iDarkPawn&&document.aBattleBoard[n]<=iDarkKing&&(document.aMoveOverlay[n]=iValidMove),(n=l[0]+8*l[1])<document.aMoveOverlay.length&&n>=0&&document.aBattleBoard[n]>=iDarkPawn&&document.aBattleBoard[n]<=iDarkKing&&(document.aMoveOverlay[n]=iValidMove);break;case iDarkPawn:i=[parseInt(e),parseInt(t)+1],a=[parseInt(e),parseInt(t)+2],o=[parseInt(e)-1,parseInt(t)+1],l=[parseInt(e)+1,parseInt(t)+1],(n=i[0]+8*i[1])<document.aMoveOverlay.length&&n>=0&&0==document.aBattleBoard[n]&&(document.aMoveOverlay[n]=iValidMove,1==t&&(n=a[0]+8*a[1])<document.aMoveOverlay.length&&n>=0&&0==document.aBattleBoard[n]&&(document.aMoveOverlay[n]=iValidMove)),(n=o[0]+8*o[1])<document.aMoveOverlay.length&&n>=0&&document.aBattleBoard[n]>=iLightPawn&&document.aBattleBoard[n]<=iLightKing&&(document.aMoveOverlay[n]=iValidMove),(n=l[0]+8*l[1])<document.aMoveOverlay.length&&n>=0&&document.aBattleBoard[n]>=iLightPawn&&document.aBattleBoard[n]<=iLightKing&&(document.aMoveOverlay[n]=iValidMove)}}function Tick(e){}function fNewGame(){fInitializeGame(),fBattle()}function fBattle(){let e=document.oRuntime.objects.BattleMarker.getFirstInstance();e&&(e.isVisible=!1),document.oRuntime.goToLayout("Battle Board")}function fMainMenu(){document.oRuntime.goToLayout("Intro Splash")}function fDungeon(){let e=document.oRuntime.objects.DungeonMarker.getFirstInstance();e&&(e.isVisible=!1),document.oRuntime.goToLayout("Dungeon")}function fEvent_Click(e,t){try{fSetMarker(e)}catch(n){alert(n)}}function fEvent_TouchStart(e,t){let n=e.touches[0],i=new MouseEvent("click",{clientX:n.clientX,clientY:n.clientY});document.touching=!0,t.dispatchEvent(i)}function fEvent_MouseMove(e,t){try{fSetMarker(e)}catch(n){alert(n)}}function fEvent_TouchMove(e,t){let n=e.touches[0],i=new MouseEvent("mousemove",{clientX:n.clientX,clientY:n.clientY});document.touching=!0,t.dispatchEvent(i)}function fSetMarker(e){let t=null,n=!1;switch(document.oRuntime.layout.name){case"Battle Board":if(t=document.oRuntime.objects.BattleMarker.getFirstInstance(),refreshBounds(document.oRuntime.layout.name),e.x>=document.dMinX&&e.x<=document.dMaxX&&e.y>=document.dMinY&&e.y<=document.dMaxY){let i=Math.floor((e.x-document.dMinX)/(document.dWidth/8)),a=Math.floor((e.y-document.dMinY)/(document.dHeight/8));t.x=(i+1)*60+157,t.y=(a+0)*60+0+30,n=!0;let o=i;fMarkValidMoves(i=7-a,a=7-o),document.fRenderValidMoves(),t.isVisible||(t.isVisible=!0)}n||!t.isVisible||document.touching||(t.isVisible=!1),document.touching=!1;break;case"Dungeon":if(t=document.oRuntime.objects.DungeonMarker.getFirstInstance(),refreshBounds(document.oRuntime.layout.name),e.x>=document.dMinX&&e.x<=document.dMaxX&&e.y>=document.dMinY&&e.y<=document.dMaxY){t.isVisible||(t.isVisible=!0);let l=Math.floor((e.x-document.dMinX)/(document.dWidth/7)),$=Math.floor((e.y-document.dMinY)/(document.dHeight/6));t.x=(l+1)*60+180,t.y=($+0)*60+0+89,n=!0}n||!t.isVisible||document.touching||(t.isVisible=!1),document.touching=!1}}document.aBattleBoard=null,document.aEntranceOverlay=null,document.aMoveOverlay=null,document.bLightKingMoved=!1,document.bDarkKingMoved=!1;